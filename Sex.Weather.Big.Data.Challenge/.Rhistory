?mean
weath$temperature[weath$ymd == dates[y]]
mean(weath$temperature[weath$ymd == dates[y]],
na.rm = TRUE)
mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
weath$temperature[weath$ymd == dates[y]]
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
daily.temp
rm(y)
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
daily.temp
gtrend.weath <- data.frame("date" = weath$ymd, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
gtrend.weath
gtrend$hits
gtrend
plot(gtrend.weath$gtrend.hits ~ gtrend.weath$temperature)
plot(gtrend.weath[gtrend.weath$gtrend.hits > 0] ~ gtrend.weath$temperature)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~ gtrend.weath$temperature)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0])
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$date[gtrend.weath$gtrend.hits > 0])
#path to figures folder
path.figures <- paste(wd,"/",output.folder.names[1],"/", sep = "")
rm(i)
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of the year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
filename <- paste(big.cities$name[i], "comparison.csv", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0])
# stop saving
dev.off()
# is the file really there?
file.exists(paste(wd, "/clim.figs/squam.rainfall.pdf", sep = ""))
}  # end of comparison loop
warnings()
dates
gtrend$hits
daily.temp
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of the year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0])
# stop saving
dev.off()
}  # end of comparison loop
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of the year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature", ylab = "Hits",
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of the year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature", ylab = "Hits",
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
daily.temp
>>>>>>> 35f1472f35da28ee6f3c6515f2750feb9e48b9e5
rm(i)
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature", ylab = "Hits", las = 1,
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
#
#
#==== General ==================================================================
#
# This file contains code that pertains to the following aspects of the
# sex-weather project:
#
# 1. File Management
# 2. Libraries
# 3. Global Variables
# 4. Run Custom Codes
#
#
R.version.string
# "R version 3.6.2 (2019-12-12)"
sessionInfo()  # for more info
#==== 1. Libraries==============================================================
# libraries needed for downloading gtrends and weather data
library(rnoaa)
library(gtrendsR)
# if you don't have the library yet, please install it! Either with the script
# below, or with the "Install Packages..." option under the 'Tools' menu
# install.packages("rnoaa")
# install.packages("gtrendsR")
#======== 2. File Management ===================================================
# working directory
wd <- getwd()
# folders for storing data outputs and figures
# store names of the folders in an object
output.folder.names <- c("figures", "data.output")
# and make the folders if they don't exist yet.
for(i in 1:length(output.folder.names))
if(file.exists(output.folder.names[i]) == FALSE)
dir.create(output.folder.names[i])
#path to figures folder
path.figures <- paste(wd,"/",output.folder.names[1],"/", sep = "")
#path to data folder
path.data <- paste(wd,"/",output.folder.names[2],"/", sep = "")
#===== 3. Global Variables =====================================================
countries <- gtrendsR::countries
categories <- gtrendsR::categories
# city populations, latitudes, and longitudes data modified from:
# https://simplemaps.com/data/us-cities
cities <- read.csv("cities.csv",
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# removing cities with populations under 50,000
big.cities <- subset(cities, Population > 50000)
# What is the category id for sexual enhancement?
se <- categories$id[categories$name == "Sexual Enhancement"]
# [1] "1236"
#============================ 4. Run Custom Codes ==============================
# # Run Saving.Search.Data script
# source("saving.search.data.R")
# # Run comparison script
# source("comparison.R")
#============================ End of Main ======================================
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature", ylab = "Hits", las = 1,
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
# execute the weather data download function
download.gtrends.data()
# # Run Saving.Search.Data script
source("2.saving.search.data.R")
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates, "gtrend.hits" = gtrend$hits,
temperature = daily.temp)
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature", ylab = "Hits", las = 1,
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
daily.temp
dates
gtrend$hits
temperature = daily.temp
daily.temp
gtrend$hits
daily.temp
dates
unique(weath$ymd)
weath$date
weath$ymd
unique(weath$ymd)
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates,
"gtrend.hits" = gtrend$hits[1:length(dates)],
"temperature" = daily.temp[1:length(dates)])
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature", ylab = "Hits", las = 1,
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates,
"gtrend.hits" = gtrend$hits[1:length(dates)],
"temperature" = daily.temp[1:length(dates)])
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature (F)", ylab = "Hits", las = 1,
xlim = c(0, 90),
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates,
"gtrend.hits" = gtrend$hits[1:length(dates)],
"temperature" = daily.temp[1:length(dates)])
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature (F)", ylab = "Hits", las = 1,
xlim = c(0, 90),
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
for(i in 1:length(big.cities$name)){
weath <- read.csv(paste(path.data, big.cities$name[i], ".weather.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
gtrend <- read.csv(paste(path.data, big.cities$name[i], ".gtrends.csv",
sep = ""),
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# reducing date and time to just date for weather data
weath$ymd <- substr(weath$date, 1, 10)
# names for each day of the year in weather dataset
dates <- unique(weath$ymd)
# this loop creates a vector with the mean temperature for each day of year
daily.temp <- rep(NA, 365)
for(y in 1:length(unique(weath$ymd))){
daily.temp[y] <- mean(as.numeric(weath$temperature[weath$ymd == dates[y]]),
na.rm = TRUE)
}  # end of daily temperature loop
# combine gtrends and weather data by day of year
gtrend.weath <- data.frame("date" = dates,
"gtrend.hits" = gtrend$hits[1:length(dates)],
"temperature" = daily.temp[1:length(dates)])
filename <- paste(big.cities$name[i], "comparison.pdf", sep = ".")
# start saving of pdf
pdf(paste(path.figures, paste(filename), sep = ""),
width = 5, height = 5)
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature (F)", ylab = "Hits", las = 1,
xlim = c(0, 90),
main = "Google Searches for Sexual Enhancement")
# stop saving
dev.off()
}  # end of comparison loop
warnings()
plot(gtrend.weath$gtrend.hits[gtrend.weath$gtrend.hits > 0] ~
gtrend.weath$temperature[gtrend.weath$gtrend.hits > 0],
xlab = "Temperature (F)", ylab = "Hits", las = 1,
xlim = c(0, 90),
main = "Google Searches for Sexual Enhancement")
