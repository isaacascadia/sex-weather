cities <- read.csv("cities.csv",
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
big.cities <- subset(cities, Population > 50000)
View(big.cities)
a <- matrix(1:9, nrow=3)
b <- subset(a, a[ , 3] < 9)
View(a)
View(b)
View(a)
#rerunning Isaac's code with big.cities
for(i in 1:(length(big.cities$name)/2)){
list <- gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
for(i in (length(big.cities$name)/2):length(big.cities$name)){
list <- gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
for(i in 1:(length(big.cities$name)/2)){
list <- gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
for(i in (length(big.cities$name)/2):length(big.cities$name)){
list <- gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
for(i in (length(big.cities$name)/2):length(big.cities$name)){
list <- gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
for(i in (length(big.cities$name)/2):length(big.cities$name)){
list <- gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
for(i in (length(big.cities$name)/2):length(big.cities$name)){
list <- gtrendsR::gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
for(i in (length(big.cities$name)/2):length(big.cities$name)){
list <- gtrendsR::gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
#rerunning Isaac's code with big.cities
for(i in 1:(length(big.cities$name)/2)){
list <- gtrendsR::gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
obj <- list$interest_over_time
write.csv(obj, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
length(big.cities$name)/2)
length(big.cities$name)/2
big.cities$name)/2
length(big.cities$name)/2
length(big.cities$name)/2+1
#
# the main.R file is at the centre of my projects. Start here!
# 1) which libraries are needed
# 2) make folder structure and create paths to folders
# 3) define 'global' variables; variables used throughout the code
# 4) run R scripts with e.g. custum functions functions
#
#
# typically start with the version of R it works on
#
R.version.string
sessionInfo()  # for more info
View(big.cities)
#
#
#==== General ==================================================================
#
# This file contains code that pertains to the following aspects of the
# sex-weather project:
#
# 1. File Management
# 2. Libraries
# 3. Global Variables
# 4. Run Custom Codes
#
#
R.version.string
# "R version 3.6.2 (2019-12-12)"
sessionInfo()  # for more info
#==== 1. Libraries==============================================================
# libraries contain specific functions and they come in many shapaes an forms
# library("name of package")
library(rnoaa)
library(gtrendsR)
library(dplyr)
# if you don't have the library yet, install it! Either through the 'Tools' menu
# or install.packages("name of package")
#======== 2. File Management ===================================================
# working directory
wd <- getwd()
# names of folders for output data (figures,data output,data)
# store names of the folders in an object
output.folder.names <- c("figures", "data.output")
# and make the folders if they don't exit yet. No need to understand this now
for(i in 1:length(output.folder.names))
if(file.exists(output.folder.names[i]) == FALSE)
dir.create(output.folder.names[i])
#===== 3. Global Variables =====================================================
countries <- gtrendsR::countries
categories <- gtrendsR::categories
# from: https://simplemaps.com/data/us-cities
cities <- read.csv("cities.csv",
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# removing with populations under 50,000
big.cities <- subset(cities, Population > 50000)
# What is the category id for sexual enhancement?
se <- categories$id[categories$name == "Sexual Enhancement"]
# [1] "1236"
#============================ 4. Run Custom Codes ==============================
#============================ End of Main ======================================
# checking work
for(i in 1:length(big.cities$name)){
file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
} %>%
return()
# checking work
for(i in 1:length(big.cities$name)){
file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
} %>%  return()
# checking work
for(i in 1:length(big.cities$name)){
file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
i <- 1
file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
".gtrends",
rm(i)
csv.check <- rep(NA, 178)
for(i in 1:length(big.cities$name)){
csv.check[i]  file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
csv.check <- rep(NA, 178)
for(i in 1:length(big.cities$name)){
csv.check[i]  file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
csv.check <- rep(NA, 178)
for(i in 1:length(big.cities$name)){
csv.check[i]  file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
csv.check <- rep(NA, 178)
for(i in 1:length(big.cities$name)){
csv.check[i]  file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
for(i in 1:length(big.cities$name)){
csv.check[i]  file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
csv.check <- rep(NA, 178)
for(i in 1:length(big.cities$name)){
csv.check[i]  file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
csv.check <- rep(NA, 178)
for(i in 1:length(big.cities$name)){
csv.check[i] <- file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
unique(csv.check)
csv.check[120] <-
420 = 20
420 = 20
420 = 20
csv.check[120] <- 2
420 = 20
420 == 20
csv.check[120] <- 2 == 420
which(csv.check = "FALSE")
?which(csv.check = "FALSE")
which(csv.check = FALSE)
which(csv.check == FALSE)
for(i in 1:length(big.cities$name)){
csv.check[i] <- file.exists(paste(wd, "/data.output/", as.character(big.cities[i,1]),
".csv", sep = ""))
}
which(csv.check == FALSE)
csv.check[120] <- 20 == 420
# which
big.cities$name[which(csv.check == FALSE)]
# which city doesn't
big.cities$name[which(csv.check == FALSE)]
for(i in 1:length(big.cities$name)){
csv.check[i] <- file.exists(paste(wd, "/data.output/",
as.character(big.cities[i,1]), ".csv",
".gtrends", sep = ""))
}
# which city doesn't
big.cities$name[which(csv.check == FALSE)]
which(csv.check == FALSE)
csv.check
# checking work
csv.check <- rep(NA, 178)
csv.check
for(i in 1:length(big.cities$name)){
csv.check[i] <- file.exists(paste(wd, "/data.output/",
as.character(big.cities[i,1]), ".csv",
".gtrends", sep = ""))
}
csv.check
csv.check[i] <- file.exists(paste(wd, "/data.output/",
as.character(big.cities[i,1]), ".csv",
# ".gtrends",
sep = ""))
csv.check
csv.check <- rep(NA, 178)
for(i in 1:length(big.cities$name)){
csv.check[i] <- file.exists(paste(wd, "/data.output/",
as.character(big.cities[i,1]), ".csv",
# ".gtrends",
sep = ""))
}
csv.check
# which city doesn't
big.cities$name[which(csv.check == FALSE)]
fcsv.check.gtrend <- function(){
csv.check <- rep(NA, 178)
for(i in 1:length(big.cities$name)){
csv.check[i] <- file.exists(paste(wd, "/data.output/",
as.character(big.cities[i,1]), ".csv",
# ".gtrends",
sep = ""))
}
# do any cities not have a gtrends query .csv?
return(big.cities$name[which(csv.check == FALSE)])
}
fcsv.check.gtrend()
gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
#
#
#==== General ==================================================================
#
# This file contains code that pertains to the following aspects of the
# sex-weather project:
#
# 1. File Management
# 2. Libraries
# 3. Global Variables
# 4. Run Custom Codes
#
#
R.version.string
# "R version 3.6.2 (2019-12-12)"
sessionInfo()  # for more info
#==== 1. Libraries==============================================================
# libraries contain specific functions and they come in many shapaes an forms
# library("name of package")
library(rnoaa)
library(gtrendsR)
library(dplyr)
# if you don't have the library yet, install it! Either through the 'Tools' menu
# or install.packages("name of package")
#======== 2. File Management ===================================================
# working directory
wd <- getwd()
# names of folders for output data (figures,data output,data)
# store names of the folders in an object
output.folder.names <- c("figures", "data.output")
# and make the folders if they don't exit yet. No need to understand this now
for(i in 1:length(output.folder.names))
if(file.exists(output.folder.names[i]) == FALSE)
dir.create(output.folder.names[i])
#===== 3. Global Variables =====================================================
countries <- gtrendsR::countries
categories <- gtrendsR::categories
# from: https://simplemaps.com/data/us-cities
cities <- read.csv("cities.csv",
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# removing with populations under 50,000
big.cities <- subset(cities, Population > 50000)
# What is the category id for sexual enhancement?
se <- categories$id[categories$name == "Sexual Enhancement"]
# [1] "1236"
#============================ 4. Run Custom Codes ==============================
#============================ End of Main ======================================
gtrends(geo = as.character(big.cities[i,3]),
category = 1236, onlyInterest = TRUE)
list1 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-01-01 2018-06-30",
onlyInterest = TRUE)
list2 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-07-01 2018-12-31",
onlyInterest = TRUE)
iot <- list1$interest_over_time
iot[182:365,] <- list2$interest_over_time
View(iot)
class(iot)
iot <- data.frame(date = rep(NA, 365), hits = rep(NA, 365), geo = rep(NA, 365),
category = rep(NA, 365))
rm(iot)
iot <- data.frame(date = rep(NA, 365), hits = rep(NA, 365), geo = rep(NA, 365),
category = rep(NA, 365))
list1 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-01-01 2018-06-30",
onlyInterest = TRUE)
list2 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-07-01 2018-12-31",
onlyInterest = TRUE)
iot <- list1$interest_over_time
iot[182:365,] <- list2$interest_over_time
View(iot)
View(list2)
rm(iot)
View(list2)
iot <- data.frame(date = rep(NA, 365), hits = rep(NA, 365), geo = rep(NA, 365),
category = rep(NA, 365))
df1 <- list1$interest_over_time <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-01-01 2018-06-30",
onlyInterest = TRUE)
df2 <- list2$interest_over_time <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-07-01 2018-12-31",
onlyInterest = TRUE)
View(df2)
list1 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-01-01 2018-06-30",
onlyInterest = TRUE)
list2 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-07-01 2018-12-31",
onlyInterest = TRUE)
test <- list2$interest_over_time$date
test <- list2$interest_over_time
View(test)
iot <- data.frame(date = rep(NA, 365), hits = rep(NA, 365), geo = rep(NA, 365),
category = rep(NA, 365))
list1 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-01-01 2018-06-30",
onlyInterest = TRUE)
list2 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-07-01 2018-12-31",
onlyInterest = TRUE)
iot <- rbind(list1$interest_over_time, list2$interest_over_time)
View(iot)
rm(iot)
list1 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-01-01 2018-06-30",
onlyInterest = TRUE)
list2 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-07-01 2018-12-31",
onlyInterest = TRUE)
iot <- rbind(list1$interest_over_time, list2$interest_over_time)
View(iot)
class(iot)
rm(iot)
class(iot)
list1 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-01-01 2018-06-30",
onlyInterest = TRUE)
list2 <- gtrends(geo = as.character(big.cities[1,3]),
category = 1236,
time = "2018-07-01 2018-12-31",
onlyInterest = TRUE)
iot <- rbind(list1$interest_over_time, list2$interest_over_time)
View(iot)
#
#
#==== General ==================================================================
#
# This file contains code that pertains to the following aspects of the
# sex-weather project:
#
# 1. File Management
# 2. Libraries
# 3. Global Variables
# 4. Run Custom Codes
#
#
R.version.string
# "R version 3.6.2 (2019-12-12)"
sessionInfo()  # for more info
#==== 1. Libraries==============================================================
# libraries contain specific functions and they come in many shapaes an forms
# library("name of package")
library(rnoaa)
library(gtrendsR)
library(dplyr)
# if you don't have the library yet, install it! Either through the 'Tools' menu
# or install.packages("name of package")
#======== 2. File Management ===================================================
# working directory
wd <- getwd()
# names of folders for output data (figures,data output,data)
# store names of the folders in an object
output.folder.names <- c("figures", "data.output")
# and make the folders if they don't exit yet. No need to understand this now
for(i in 1:length(output.folder.names))
if(file.exists(output.folder.names[i]) == FALSE)
dir.create(output.folder.names[i])
#===== 3. Global Variables =====================================================
countries <- gtrendsR::countries
categories <- gtrendsR::categories
# from: https://simplemaps.com/data/us-cities
cities <- read.csv("cities.csv",
stringsAsFactors = FALSE,
strip.white = TRUE,
na.strings = c(NA, ""))
# removing with populations under 50,000
big.cities <- subset(cities, Population > 50000)
# What is the category id for sexual enhancement?
se <- categories$id[categories$name == "Sexual Enhancement"]
# [1] "1236"
#============================ 4. Run Custom Codes ==============================
#============================ End of Main ======================================
# loop to create .csv for first half of gtrends queries
for(i in 1:(length(big.cities$name)/2)){
# querying gtrends for first half of year and saving to object
first.6mo <- gtrends(geo = as.character(big.cities[i,3]), category = 1236,
time = "2018-01-01 2018-06-30", onlyInterest = TRUE)
# querying gtrends for second half of year and saving to object
second.6mo <- gtrends(geo = as.character(big.cities[i,3]), category = 1236,
time = "2018-07-01 2018-12-31", onlyInterest = TRUE)
# combining first and second half to get whole year interest over time
iot <- rbind(first.6mo$interest_over_time, second.6mo$interest_over_time)
# saving combined interest over time to .csv
write.csv(iot, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".gtrends", ".csv", sep = ""))
}  # end of loop
# loop to create .csv for second half of gtrends queries
for(i in (length(big.cities$name)/2):length(big.cities$name)){
# querying gtrends for first half of year and saving to object
first.6mo <- gtrends(geo = as.character(big.cities[i,3]), category = 1236,
time = "2018-01-01 2018-06-30", onlyInterest = TRUE)
# querying gtrends for second half of year and saving to object
second.6mo <- gtrends(geo = as.character(big.cities[i,3]), category = 1236,
time = "2018-07-01 2018-12-31", onlyInterest = TRUE)
# combining first and second half to get whole year interest over time
iot <- rbind(first.6mo$interest_over_time, second.6mo$interest_over_time)
# saving combined interest over time to .csv
write.csv(iot, paste(wd, "/data.output/", as.character(big.cities[i,1]),
".gtrends", ".csv", sep = ""))
}  # end of loop
# checking presence of .csvs
fcsv.check.gtrend <- function(){      # function definition
csv.check <- rep(NA, 178)             # vector contains Boolean .csv presence
for(i in 1:length(big.cities$name)){  # loop checks .csv presence for each city
# populating vector w/ Boolean presence
csv.check[i] <- file.exists(paste(wd, "/data.output/",
as.character(big.cities[i,1]), ".csv",
".gtrends", sep = ""))
}
# which cities don't have a gtrends query .csv?
return(big.cities$name[which(csv.check == FALSE)])
}
# Running the function - do any cities not have a gtrends query .csv?
fcsv.check.gtrend()
fcsv.check.gtrend <- function(){      # function definition
csv.check <- rep(NA, 178)             # vector contains Boolean .csv presence
for(i in 1:length(big.cities$name)){  # loop checks .csv presence for each city
# populating vector w/ Boolean presence
csv.check[i] <- file.exists(paste(wd, "/data.output/",
as.character(big.cities[i,1]), ".gtrends",
".csv", sep = ""))
}
# which cities don't have a gtrends query .csv?
return(big.cities$name[which(csv.check == FALSE)])
}
# Running the function - do any cities not have a gtrends query .csv?
fcsv.check.gtrend()
